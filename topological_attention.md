<h3>Какую задачу решают</h3>

Рассматривается задача прогнозирование одномерных временных рядов. В качестве улучшения существующих методов проверяют, могут ли локальные топологические свойства ряда помочь в прогнозировании. Создали Topological Attention, который можно без проблем встроить в любые уже существующие нейросети, к примеру в N-BEATS, в сочетании с которой демонстрирует хорошую производительность. Показали, что улучшает качество как в предсказании множества связанных рядов, так и в предсказании одного (но достаточно длинного) ряда.

<h3>Представление рядов</h3>

Так как мы хотим получить локальные свойства, рассматриваются пересекающиеся окна длины T. Рассмотрим множество ![image](https://user-images.githubusercontent.com/48079881/155843508-38d28379-97dd-4b73-9708-d94e7515e51b.png) - набор вершин и соседних пар нашего окна. Топологически K обладает свойствами связности временного ряда длины T. Это множество не несет никакой информации, так как для любых окон будет одинаковым. 


Для каждого конкретного окна x отсортируем все значения и обозначим как ![image](https://user-images.githubusercontent.com/48079881/155843526-0ee61de6-78da-406a-b477-a11c33f478e5.png)
. Введем множества ![image](https://user-images.githubusercontent.com/48079881/155843542-be9a8582-4c47-4fc4-bd4e-4a8b90a931ed.png)
. Очевидно, ![image](https://user-images.githubusercontent.com/48079881/155843553-5e0d778d-1d21-4180-85ee-be01424106ea.png)
, это задает некоторую эволюцию. Откуда мы ищем представление нашего окна в виде пар (birth, death) в зависимости от порядка появления точек и пар точек в множествах K:
![image](https://user-images.githubusercontent.com/48079881/155843564-966a8c83-355b-40b3-bbda-105ea7a7df9e.png)


Информация, получаемая в ходе этого процесса, имеет два свойства. Во-первых, она стабильна в том смысле, что небольшие изменения наблюдаемых значений не могут вызывать произвольных изменений соответствующих представлений. Во-вторых, можно также упорядочить отрицательные наблюдения, т. е. −x, и, таким образом, получить второе представление. То есть, сигнал анализируется снизу и сверху.

Для большей информации представление создается не только для одного окна, а для нескольких соседних (W окон).

Так как работать с таким представлением не представляется возможным, Задают отображение  ![image](https://user-images.githubusercontent.com/48079881/155843596-4d6884fe-c3eb-49d6-9e26-8b75312a80ea.png)
, где s - некоторая функция от 2 переменных, сохраняющая стабильность. Для большей информативности вводят несколько таких функций (e штук): ![image](https://user-images.githubusercontent.com/48079881/155843612-c98fce12-cdee-4150-a5d5-701df326d504.png)
.

В итоге из W штук окон мы получаем уже числовую матрицу, содержащую в себе топологическую информацию:
![image](https://user-images.githubusercontent.com/48079881/155843625-c8142d3b-261b-44c3-876f-3838492d9f2b.png)


<h3>Механизм внимания</h3>

Полученную матрицу A пропускают через обычный attention:
![image](https://user-images.githubusercontent.com/48079881/155843655-cb9c69f2-a314-438c-8fc9-441c9b990003.png)


 где k - key, v - value, q - query. Составляя E таких слоев получаем:
 ![image](https://user-images.githubusercontent.com/48079881/155843662-e16aadf0-a1ab-4cd1-9da4-102909a5c9dd.png)


В итоге получаем Topological Attention слой:
![image](https://user-images.githubusercontent.com/48079881/155843671-796c6618-2a74-41d2-84b8-2f23e9416f40.png)


где vec(.) обозначает операции векторизации по строкам, а MLP - двуслойный перцептрон с ReLu.

<h3>Применение</h3>

В статье встроили Topological Attetion в N-BEATS:
![image](https://user-images.githubusercontent.com/48079881/155843682-0bdda2a4-04a8-4580-a387-52354f2766bd.png)


В каждый блок S подается не только выход предыдущего, но и сконкатенированная информация с Toplogical Attention ![image](https://user-images.githubusercontent.com/48079881/155843688-262e0e8c-b099-41a2-a78a-354fba87f6a3.png)


Так же сделали Linear + Topological Attention: ![image](https://user-images.githubusercontent.com/48079881/155843693-5a917122-2e06-48c0-9801-f4caa221887d.png)


<h3>Эксперименты</h3>
<h4>Один ряд</h4>

Хотят предсказывать длинные ряды отдельно. Взяли данные потребления электричества (10 рядов, длина ряда 3762) и спрос на машины (4 ряда, длина ряда 4644).

Взяли 5% под валидацию и 20% под тест. Меряли sMAPE, в табличке показан средний ранг прогнозов (при прогнозировании всех рядов в наборе по одном) и средняя ошибка в процентах от топ-1 метода. Результаты:
![image](https://user-images.githubusercontent.com/48079881/155843714-c118beeb-6585-4325-8fcd-a1dce17d3ce0.png)


<h4>Много рядов</h4>

Предсказывали M4 (100000 рядов, 6 разных групп). 

![image](https://user-images.githubusercontent.com/48079881/155843735-32f1b4da-385e-4473-a626-6effd637a7b0.png)


N-BEATS и N-BEATS+TopAttn - ансамбль нескольких моделей с разными параметрами и инициализациями.

Попробовали запустить только с Topological признаками и с Attention по отдельности, но получили ухудшения

![image](https://user-images.githubusercontent.com/48079881/155843737-e2868d91-7555-4f11-a663-efaac338e5d6.png)



